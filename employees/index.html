<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Management</title>
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9f9f9;
        color: #333;
      }

      #container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      table {
        border-collapse: collapse;
        width: 100%;
        margin: 20px 0;
        font-size: 16px;
        text-align: left;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }

      th {
        background-color: #007bff;
        color: white;
      }

      tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      tr:hover {
        background-color: #f1f1f1;
      }

      button {
        padding: 8px 12px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        font-size: 14px;
        cursor: pointer;
        color: white;
      }

      button:nth-child(1) {
        background-color: #28a745;
      }

      button:nth-child(2) {
        background-color: #ffc107;
      }

      button:nth-child(3) {
        background-color: #dc3545;
      }

      button:hover {
        opacity: 0.9;
      }

      form {
        display: none;
        width: 30%;
        flex-direction: column;
        gap: 1px;
        margin-top: 20px;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        z-index: 1000;
      }

      form label {
        font-weight: bold;
      }

      form input,
      form select {
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      form button {
        align-self: flex-start;
        background-color: #007bff;
      }

      form button:nth-child(2) {
        background-color: #6c757d;
      }

      h2 {
        color: #007bff;
        text-align: center;
      }

      #overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="container">
        <table>
          <thead>
            <tr>
              <th>STT</th>
              <th>Tên</th>
              <th>Ngày sinh</th>
              <th>Giới tính</th>
              <th>Lương</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(employees, index) in employees" :key="employees.id">
              <td>{{ index + 1 }}</td>
              <td>{{ employees.name }}</td>
              <td>{{ employees.dob }}</td>
              <td>{{ employees.gender }}</td>
              <td>{{ employees.salary }}</td>
              <td>
                <button @click="showForm(employees)">Sửa</button>
                <button @click="deleteEmployee(employees)">Xóa</button>
                <button @click="detailEmployee(employees)">Xem Chi tiết</button>
              </td>
            </tr>
          </tbody>
        </table>

        <button @click="showForm()">Thêm Nhân Viên</button>
      </div>

      <div id="overlay" @click="hideForm"></div>

      <form @submit.prevent="updateEmployee">
        <h2 id="title">{{ isEditing ? 'Sửa Nhân Viên' : 'Thêm Nhân Viên' }}</h2>
        <label>Tên:</label>
        <input v-model="form.name" required /><br />

        <label>Ngày sinh:</label>
        <input type="date" v-model="form.dob" required /><br />

        <label>Giới tính:</label>

        <select v-model="form.gender" required>
          <option value="MALE">Nam</option>
          <option value="FEMALE">Nữ</option>
          <option value="OTHER">Khác</option></select
        ><br />
        <label>Lương:</label>
        <input type="number" v-model="form.salary" required /><br />

        <label>Số điện thoại:</label>
        <input v-model="form.phone" required /><br />

        <button type="submit" id="submitButton">
          {{ isEditing ? 'Cập nhật' : 'Thêm mới' }}
        </button>
        <button type="button" @click="hideForm">Hủy</button>
      </form>
    </div>

    <script>
      const { createApp } = Vue;
      createApp({
        data() {
          return {
            employees: [],
            form: {
              id: "",
              name: "",
              dob: "",
              gender: "",
              salary: "",
              phone: "",
            },
            isEditing: false,
          };
        },
        mounted() {
          this.fetchEmployees();
        },
        methods: {
          fetchEmployees() {
            axios
              .get("http://localhost:8080/employees")
              .then((response) => {
                this.employees = response.data.data;
              })
              .catch((error) => {
                console.error(error);
              });
          },
          updateEmployee() {
            if (this.isEditing) {
              axios
                .put("http://localhost:8080/employees", this.form)
                .then(() => {
                  this.fetchEmployees();
                  this.hideForm();
                })
                .catch((error) => {
                  console.error(error);
                });
            } else {
              function generateUUID() {
                return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
                  /[xy]/g,
                  function (c) {
                    var r = (Math.random() * 16) | 0,
                      v = c === "x" ? r : (r & 0x3) | 0x8;
                    return v.toString(16);
                  }
                );
              }
              axios
                .post("http://localhost:8080/employees", {
                  id: generateUUID(),
                  name: this.form.name,
                  dob: this.form.dob,
                  gender: this.form.gender,
                  salary: this.form.salary,
                  phone: this.form.phone,
                })
                .then(() => {
                  this.fetchEmployees();
                  this.hideForm();
                })
                .catch((error) => {
                  console.error(error);
                });
            }
          },
          showForm(employee = null) {
            const elements = document.querySelectorAll(
              'input[type="date"], select'
            );
            elements.forEach((el) => {
              el.disabled = false;
            });
            this.isEditing = !!employee;
            this.form = employee
              ? { ...employee }
              : {
                  id: "",
                  name: "",
                  dob: "",
                  gender: "",
                  salary: "",
                  phone: "",
                };
            document.querySelector("form").style.display = "flex";
            document.getElementById("overlay").style.display = "block";
          },
          detailEmployee(employee = null) {
            this.form = employee;
            document.querySelector("form").style.display = "flex";
            document.getElementById("overlay").style.display = "block";
            document.getElementById("submitButton").style.display = "none";
            document.getElementById("title").innerText = "Xem Chi Tiết Nhân Viên";
            const elements = document.querySelectorAll(
              'input[type="date"], select'
            );
            elements.forEach((el) => {
              el.disabled = true;
            });
          },
          hideForm() {
            document.querySelector("form").style.display = "none";
            document.getElementById("overlay").style.display = "none";
          },
          deleteEmployee(employee) {
            axios
              .delete("http://localhost:8080/employees", { data: employee })
              .then((response) => {
                this.fetchEmployees();
              })
              .catch((error) => {
                console.error(error);
              });
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
